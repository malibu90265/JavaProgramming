<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="weekendDAO">
	<resultMap id="weekendMap" type="com.sqisoft.iqs.pf.vo.WeekendVO">
		<result property="week_div"			column="week_div" />
		<result property="pj_id"			column="PJ_ID" />
		<result property="team_id"			column="TEAM_ID" />
		<result property="team_name"		column="TEAM_NAME"/>
		<result property="pre_state"		column="PRE_STATE" />
		<result property="post_state"		column="POST_STATE" />
		<result property="week_contract"	column="WEEK_CONTRACT" />
		<result property="week_income"		column="WEEK_INCOME" />
		<result property="week_netincome"	column="WEEK_NETINCOME" />
		<result property="week_ebit"		column="WEEK_EBIT" />
		<result property="empl_id"			column="EMPL_ID" />
		<result property="timestamp"		column="TIMESTAMP" />
	</resultMap>
	
	<resultMap id="weekbudgetMap" type="com.sqisoft.iqs.pf.vo.WeekBudgetVO">
		<result property="team_id"		column="TEAM_ID" />
		<result property="wb_date"		column="WB_DATE" />
		<result property="wb_contract"	column="WB_CONTRACT" />
		<result property="wb_income"	column="WB_INCOME" />
		<result property="wb_netincome"	column="WB_NETINCOME" />
		<result property="wb_ebit"		column="WB_EBIT" />
		<result property="wb_sal"		column="WB_SAL" />
		<result property="wb_product"	column="WB_PRODUCT" />
		<result property="week_ebit"	column="WEEK_EBIT" />
		<result property="wb_charge"	column="WB_CHARGE" />
	</resultMap>
	
	<insert id="insertLog" parameterType="com.sqisoft.iqs.pf.vo.WeekendVO">
		INSERT	INTO	weekend	(
									week_div
									, pj_id
									, team_id
									, pre_state
									, post_state
									, week_contract
									, week_income
									, week_netincome
									, week_ebit
									, empl_id
									, timestamp
								)
						VALUES (
									#{week_div}
									, #{pj_id}
									, #{team_id}
									, #{pre_state}
									, #{post_state}
									, #{week_contract}
									, #{week_income}
									, #{week_netincome}
									, #{week_ebit}
									, #{empl_id}
									,now()
								)
	</insert>
	
	<select id="getLog" parameterType="String"  resultMap="weekendMap">
		SELECT	*
		FROM	weekend a
				, team b
		WHERE	week_div=1 
		AND		(timestamp = DATE(#{wb_date}) 
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 1 DAY)
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 2 DAY)
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 3 DAY)
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 4 DAY)
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 5 DAY)
		OR		timestamp = DATE_SUB(#{wb_date}, INTERVAL 6 DAY))
		AND		a.team_id=b.team_id
<!-- 		WHERE timestamp <= date(#{wb_date}) AND timestamp > DATE_SUB(#{wb_date}, INTERVAL 1 WEEK) -->
		ORDER	BY a.team_id ASC
				, week_div ASC
	</select>
	
	<select id="getWeekBudgetDate" resultType="String">
		SELECT	MAX(wb_date)
		FROM	week_budget
	</select>
	
	<select id="getWeekBudgetListCurrent" parameterType="String" resultMap="weekbudgetMap">
		SELECT	*
		FROM	week_budget
		WHERE	wb_date = #{date}
       	ORDER	BY team_id
	</select>
	
	<select id="getWeekBudgetListLast" parameterType="String" resultMap="weekbudgetMap">
		SELECT	*
		FROM	week_budget
		WHERE	wb_date = DATE_SUB(#{date}, INTERVAL 1 WEEK)
		ORDER	BY team_id
	</select>
	
	<select id="getWeekBudgetDateList" resultType="String">
		SELECT	wb_date
		FROM	week_budget
		GROUP	BY wb_date
		ORDER	BY wb_date DESC
	</select>
	
	<insert id="insertWeekBudget" parameterType="com.sqisoft.iqs.pf.vo.WeekBudgetVO">
		INSERT	INTO	week_budget	(
										team_id
										, wb_date
										, wb_contract
										, wb_income
										, wb_netincome
										, wb_ebit
										, wb_sal
										, wb_product
										, wb_charge
									)
						VALUES		(
										#{team_id}
										, now()
										, #{wb_contract}
										, #{wb_income}
										, #{wb_netincome}
										, #{wb_ebit}
										, #{wb_sal}
										, #{wb_product}
										, #{wb_charge}
									)
	</insert>


</mapper>
