<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">
	<!-- 게시판 글 목록 가져오기 -->
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
           SELECT  IDX,
					    TITLE,
					    HIT_CNT,
					    CREA_DTM
			FROM   TB_BOARD
			WHERE DEL_GB = 'N'    
			ORDER BY IDX DESC
	</select>
	
	<!-- 글쓰기 -->
	<insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
        INSERT INTO TB_BOARD
        (
            TITLE, 
            CONTENTS, 
            HIT_CNT, 
            DEL_GB, 
            CREA_DTM, 
            CREA_ID
        )
        VALUES
        (
            #{TITLE}, 
            #{CONTENTS}, 
            0, 
            'N', 
            NOW(), 
            'Admin'
        )
	</insert>
	
	<!-- 조회수 1 증가 -->
	<update id="updateHitCnt" parameterType="hashmap">
        UPDATE TB_BOARD 
        SET
            HIT_CNT = IFNULL(HIT_CNT, 0) + 1
        WHERE
            IDX = #{IDX}    
	</update>
	 
	 <!-- 글 내용 가져오기 -->
	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
	        SELECT
	            IDX,
	            HIT_CNT,
	            CREA_ID,
	            CREA_DTM,
	            TITLE,
	            CONTENTS
	        FROM
	            TB_BOARD
	        WHERE
	            IDX = #{IDX}        
	</select>

	<!-- 수정하기 -->
	<update id="updateBoard" parameterType="hashmap">
        UPDATE TB_BOARD 
        SET
            TITLE = #{TITLE},
            CONTENTS = #{CONTENTS}
        WHERE
            IDX = #{IDX}    
	</update>
	
	<!-- 삭제하기 -->
	<update id="deleteBoard" parameterType="hashmap">
        UPDATE TB_BOARD
        SET
            DEL_GB = 'Y'
        WHERE
            IDX = #{IDX}
	</update>
	
	<!-- 파일 첨부 -->
	<insert id="insertFile" parameterType="hashmap">
	        INSERT INTO TB_FILE
	        (
	            BOARD_IDX,
	            ORIGINAL_FILE_NAME,
	            STORED_FILE_NAME,
	            FILE_SIZE,
	            CREA_ID
	        )
	        VALUES
	        (
	            #{BOARD_IDX},
	            #{ORIGINAL_FILE_NAME},
	            #{STORED_FILE_NAME},
	            #{FILE_SIZE},
	            'Admin'
	        )
	</insert>
	
	<!-- 첨부파일 보여주기(선택된 게시글 번호에 해당하는 첨부파일의 목록을 조회)-->
	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
	        SELECT		IDX,
	            			ORIGINAL_FILE_NAME,
	           				ROUND(FILE_SIZE/1024,1) AS FILE_SIZE
	        FROM		TB_FILE
	        WHERE		BOARD_IDX = #{IDX}
	        AND			DEL_GB = 'N'
	</select>
	
	<update id="deleteFileList" parameterType="hashmap">
	        UPDATE		TB_FILE 
	        SET			DEL_GB = 'Y'
	        WHERE		BOARD_IDX = #{IDX}  
	</update>
	 
	<update id="updateFile" parameterType="hashmap">
	        UPDATE		TB_FILE 
	        SET			DEL_GB = 'N'
	        WHERE		IDX = #{FILE_IDX}   
	</update>
</mapper>