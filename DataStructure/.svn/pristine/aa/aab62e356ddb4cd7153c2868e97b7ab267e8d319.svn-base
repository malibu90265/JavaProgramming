<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberDAO">
	<resultMap 	id="memberMap" 		type="com.sqisoft.iqs.pf.vo.MemberVO">
		<result property="name" 	column="name" />
		<result property="position" column="position" />
		<result property="job" 		column="job" />
	</resultMap>
	
	<resultMap 	id="empMap" 			type="com.sqisoft.iqs.hr.vo.Employee_VO">
		<result property="name" 		column="name" />
		<result property="position" 	column="position" />
		<result property="job" 			column="job" />
	</resultMap>
	
	<select id="nameExist" parameterType="String" resultType="int">
		SELECT	count(*)
		FROM	employee
		WHERE	name=#{pj_biz, jdbcType=VARCHAR}
	</select>
	
	<select id="nameSerch" resultMap="empMap">
		SELECT	e.name as name
				, SUBSTRING(e.position,2,2) as position
		FROM	employee e 
		order	by e.position, name
	</select>
	
	<!-- 로그인 -->
	<resultMap type="com.sqisoft.iqs.pf.vo.LoginVO" id="loginMap">
		<id		property="email"		column="email" />
		<result	property="password"		column="passwd" />
		<result	property="account"		column="account" />
		<result	property="hr_name"		column="hr_name" />
		<result	property="hr_company"	column="hr_company" />
		<result	property="tm_id"		column="tm_id" />
		<result	property="hr_position"	column="hr_position" />
		<result	property="hr_grade"		column="hr_grade" />
		<result	property="hr_hire_date"	column="hr_hire_date" />
		<result	property="hr_quit_date"	column="hr_quit_date" />
		<result	property="hr_role"		column="hr_role" />
		<result property="hr_job_skill"	column="hr_job_skill" />
	</resultMap>
	
	<select id="login" parameterType="com.sqisoft.iqs.pf.vo.LoginVO" resultMap="loginMap">
		SELECT	a.email				AS email
				, a.account			AS account
				, h.hr_name			AS hr_name
				, h.hr_company		AS hr_company
				, h.tm_id			AS tm_id
				, h.hr_position		AS hr_position
				, h.hr_grade		AS hr_grade
				, h.hr_hire_date	AS hr_hire_date
				, h.hr_quit_date	AS hr_quit_date
				, h.hr_role			AS hr_role
				, h.hr_job_skill	AS hr_job_skill
		FROM	account a, human_resource h
		WHERE	email = #{email}
		AND		a.email = h.hr_email
		<if test="password != null and password != ''">
		AND		passwd = PASSWORD(#{password})
		</if>
	</select>
	
	<update id="changePassword"
			parameterType="com.sqisoft.iqs.pf.vo.LoginVO">
		UPDATE	account
		SET		passwd = PASSWORD(#{password})
		WHERE	email = #{email}
	</update>
	
	<select id="getMember"
			parameterType="map"
			resultType="_int">
		SELECT	count(*)
		FROM	account
		WHERE	email = #{email}
		AND		passwd = PASSWORD(#{password})
	</select>
	
	<!-- 프로젝트 리스트 -->
	<select id="getLatestProject"	resultType="string">
		SELECT	pj_name
		FROM	project
		WHERE	pj_start_date BETWEEN now()
    	AND		DATE_ADD(now(), INTERVAL 5 MONTH) - INTERVAL 1 DAY
		ORDER	BY	pj_name ASC
	</select>
	
</mapper>
